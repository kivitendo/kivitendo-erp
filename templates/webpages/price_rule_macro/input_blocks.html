[%- USE T8 %]
[%- USE HTML %]
[%- USE LxERP %]
[%- USE P %]
[%- USE L %]

[% SET num_compare_ops = [
  [ 'eq', LxERP.t8('is equal to') ],
  [ 'le', LxERP.t8('is lower than or equal') ],
  [ 'ge', LxERP.t8('is greater than or equal') ],
] %]
[% SET date_compare_ops = [
  [ 'eq', LxERP.t8('is equal to') ],
  [ 'gt', LxERP.t8('is after') ],
  [ 'lt', LxERP.t8('is before') ],
] %]

[%- BLOCK condition_input %]
  [%- SWITCH item.type %]
    [%- CASE 'container_and' %][% PROCESS condition_container_and_input %]
    [%- CASE 'container_or' %][% PROCESS condition_container_or_input %]
    [%- CASE 'customer' %][% PROCESS condition_customer_input %]
    [%- CASE 'vendor' %][% PROCESS condition_vendor_input %]
    [%- CASE 'business' %][% PROCESS condition_business_input %]
    [%- CASE 'part' %][% PROCESS condition_part_input %]
    [%- CASE 'partsgroup' %][% PROCESS condition_partsgroup_input %]
    [%- CASE 'pricegroup' %][% PROCESS condition_pricegroup_input %]
    [%- CASE 've' %][% PROCESS condition_ve_input %]
    [%- CASE 'qty' %][% PROCESS condition_qty_input %]
    [%- CASE 'qty_range' %][% PROCESS condition_qty_range_input %]
    [%- CASE 'transdate' %][% PROCESS condition_transdate_input %]
    [%- CASE 'reqdate' %][% PROCESS condition_reqdate_input %]
  [% END %]
[%- END %]

[%- BLOCK condition_container_and_input %]
  <fieldset class='price_rule_container price_rule_element'>
    <legend>[%- PROCESS remove_control %] [% 'And' | $T8 %]:</legend>
      [% FOREACH row IN item.condition %]
        <div class='price_rule_element'>
          [% L.hidden_tag(prefix _ '.condition[+].type', row.type) %]
          [% INCLUDE condition_input item=row, prefix=prefix _ '.condition[]' %]
        </div>
      [% END %]
    [%- PROCESS add_element_control %]
  </fieldset>
[%- END %]

[%- BLOCK condition_container_or_input %]
  <fieldset class='price_rule_container'>
    <legend>[%- PROCESS remove_control %] [% 'Or' | $T8 %]:</legend>
      [% FOREACH row IN item.condition %]
        <div class='price_rule_element'>
          [% L.hidden_tag(prefix _ '.condition[+].type', row.type) %]
          [% INCLUDE condition_input item=row, prefix=prefix _ '.condition[]' %]
        </div>
      [% END %]
    [%- PROCESS add_element_control %]
  </fieldset>
[%- END %]

[%- BLOCK condition_customer_input %]
  <fieldset>
   <legend>[%- PROCESS remove_control %] [% 'Customer' | $T8 %] [% 'is' | $T8 %]</legend>
     [% FOREACH id = item.id %]
       [% PROCESS condition_customer_value_input %]
     [% END %]
     <span class='interact cursor-pointer'>Wert hinzufügen</span>
  </fieldset>
[%- END %]

[% BLOCK condition_customer_value_input %]
  <div class='price_rule_element'>[%- PROCESS remove_control %] [% P.customer_vendor.picker(prefix _ '.id[]', id, type='customer') %]</div>
[%- END %]

[%- BLOCK condition_vendor_input %]
  <fieldset>
   <legend>[%- PROCESS remove_control %] [% 'Vendor' | $T8 %] [% 'is' | $T8 %]</legend>
     [% FOREACH id = item.id %]
       [% PROCESS condition_vendor_value_input %]
     [% END %]
     <span class='interact cursor-pointer'>Wert hinzufügen</span>
  </fieldset>
[%- END %]

[% BLOCK condition_vendor_value_input %]
  <div class='price_rule_element'>[%- PROCESS remove_control %] [% P.customer_vendor.picker(prefix _ '.id[]', id, type='vendor') %]</div>
[%- END %]

[%- BLOCK condition_business_input %]
  <fieldset>
    <legend>
     [%- PROCESS remove_control %]
     [% 'Type of Business' | $T8 %]
     [% 'is' | $T8 %]
    </legend>
     [% FOREACH id = item.id %]
       [% PROCESS condition_business_value_input %]
     [% END %]
    <span class='interact cursor-pointer'>Wert hinzufügen</span>
  </fieldset>
[%- END %]

[%- BLOCK condition_business_value_input %]
  <div class='price_rule_element'>[%- PROCESS remove_control %] [% P.business.picker(prefix _ '.id[]', id) %]</div>
[%- END %]

[%- BLOCK condition_part_input %]
  <fieldset>
    <legend>
     [%- PROCESS remove_control %]
     [% 'Part' | $T8 %] [% 'is' | $T8 %]
    </legend>
     [% FOREACH id = item.id %]
       [% PROCESS condition_part_value_input %]
     [% END %]
    <span class='interact cursor-pointer'>Wert hinzufügen</span>
  </fieldset>
[%- END %]

[%- BLOCK condition_part_value_input %]
  <div class='price_rule_element'>[%- PROCESS remove_control %] [% P.part.picker(prefix _ '.id[]', id) %]</div>
[%- END %]

[%- BLOCK condition_partsgroup_input %]
  <fieldset>
    <legend>
      [%- PROCESS remove_control %]
      [% 'Partsgroup' | $T8 %]
      [% 'is' | $T8 %]
    </legend>
    <div>
     [% FOREACH id = item.id %]
       [% PROCESS condition_partsgroup_value_input %]
     [%- END %]
    </div>
    <span class='interact cursor-pointer'>Wert hinzufügen</span>
  </fieldset>
[%- END %]

[%- BLOCK condition_partsgroup_value_input %]
  <div class='price_rule_element'>[%- PROCESS remove_control %] [%- L.select_tag(prefix _ '.id[]', SELF.all_partsgroups, title_key='partsgroup', default=id) %]</div>
[%- END %]

[%- BLOCK condition_pricegroup_input %]
  <fieldset>
    <legend>
      [%- PROCESS remove_control %]
      [% 'Pricegroup' | $T8 %]
      [% 'is' | $T8 %]
    </legend>
     [% FOREACH id = item.id %]
       [% PROCESS condition_pricegroup_value_input %]
     [%- END %]
    <span class='interact cursor-pointer'>Wert hinzufügen</span>
[%- END %]

[%- BLOCK condition_pricegroup_value_input %]
  <div class='price_rule_element'>[%- PROCESS remove_control %] [%- L.select_tag(prefix _ '.id[]', SELF.all_pricegroups, title_key='pricegroup', default=id) %]</div>
[%- END %]

[%- BLOCK condition_ve_input %]
  <fieldset>
    <legend>
     [%- PROCESS remove_control %]
     [% 'Ve' | $T8 %]
    </legend>
    <div>
      [% L.select_tag(prefix _ '.op', num_compare_ops, default=item.op) %]
      [% L.input_tag(prefix _ '.num_as_number', item.num_as_number) %]
    </div>
  </fieldset>
[%- END %]

[%- BLOCK condition_qty_input %]
  <fieldset>
    <legend>
      [%- PROCESS remove_control %]
      [% 'Quantity' | $T8 %]
    </legend>
    <div>
      [% L.select_tag(prefix _ '.op', num_compare_ops, default=item.op) %]
      [% L.input_tag(prefix _ '.num_as_number', item.num_as_number) %]
    </div>
  </fieldset>
[%- END %]

[%- BLOCK condition_qty_range_input %]
  <fieldset>
   <legend>
     [%- PROCESS remove_control %]
     [% 'Quantity Range' | $T8 %]
   </legend>
  [% L.input_tag(prefix _ '.min_as_number', item.min_as_number) %]
  [% 'To (range)' | $T8 %]
  [% L.input_tag(prefix _ '.max_as_number', item.max_as_number) %]
  </fieldset>
[%- END %]

[%- BLOCK condition_reqdate_input %]
  <fieldset>
    <legend>
      [%- PROCESS remove_control %]
      [% 'Reqdate' | $T8 %]
    </legend>
    <div>
      [% L.select_tag(prefix _ '.op', date_compare_ops, default=item.op) %]
      [% L.date_tag(prefix _ '.date', item.date) %]
    </div>
  </fieldset>
[%- END %]

[%- BLOCK condition_transdate_input %]
  <fieldset>
    <legend>
      [%- PROCESS remove_control %]
      [% 'Transdate Record' | $T8 %]
    </legend>
    <div>
      [% L.select_tag(prefix _ '.op', date_compare_ops, default=item.op) %]
      [% L.date_tag(prefix _ '.date', item.date) %]
    </div>
  </fieldset>
[%- END %]



[%- BLOCK action_input %]
  [%- SWITCH item.type %]
    [%- CASE 'conditional_action' %][% PROCESS condition_action_input_input %]
    [%- CASE 'simple_action' %][% PROCESS simple_action_input %]
    [%- CASE 'price_scale_action' %][% PROCESS price_scale_action_input %]
    [%- CASE 'parts_price_list_action' %][% PROCESS parts_price_list_action_input %]
    [%- CASE '' %][% PROCESS add_element_control %]
  [% END %]
[%- END %]

[%- BLOCK action_conditional_action_input %]
[%- END %]

[%- BLOCK simple_action_input %]
  [% PROCESS simple_discount_action_input %]
[%- END %]

[%- BLOCK old_simple_action_input %]
<div>
  [% 'Set (set to)' | $T8 %]
  [% L.select_tag(prefix _ '.price_type', SELF.all_price_types, default=item.price_type) %]
  [% 'to (set to)' | $T8 %]
  [% L.input_tag(prefix _ '.price_or_discount_as_number', item.price_or_discount_as_number) %]
  <a id='price_rule_price_type_help' class='interact cursor-help' title='[% 'Price type explanation' | $T8 %]'>[?]</a>
</div>
[%- END %]

[%- BLOCK simple_price_action_input %]
<div>
  [% 'Set (set to)' | $T8 %]
  [% 'Price' | $T8 %]
  [% 'to (set to)' | $T8 %]
  [% L.input_tag(prefix _ '.price_as_number', item.price_as_number, class='numeric', "data-validate"='number') %]
  <a id='price_rule_price_type_help' class='interact cursor-help' title='[% 'Price type explanation' | $T8 %]'>[?]</a>
</div>
[%- END %]

[%- BLOCK simple_discount_action_input %]
<div>
  [% 'Set (set to)' | $T8 %]
  [% 'Discount' | $T8 %]
  [% 'to (set to)' | $T8 %]
  [% L.input_tag(prefix _ '.discount_as_number', item.discount_as_number, class='numeric', "data-validate"='number') %] %
  <a id='price_rule_price_type_help' class='interact cursor-help' title='[% 'Price type explanation' | $T8 %]'>[?]</a>
</div>
[%- END %]

[%- BLOCK simple_reduction_action_input %]
<div>
  [% 'Set (set to)' | $T8 %]
  [% 'Reduced Master Data' | $T8 %]
  [% 'to (set to)' | $T8 %]
  [% L.input_tag(prefix _ '.reduction_as_number', item.reduction_as_number, class='numeric', "data-validate"='number') %]
  <a id='price_rule_price_type_help' class='interact cursor-help' title='[% 'Price type explanation' | $T8 %]'>[?]</a>
</div>
[%- END %]

[%- BLOCK conditional_action %]
  <div>
    [% INCLUDE condition_input item=item.condition %]
    [% INCLUDE action_input item=item.action %]
  <div>
[%- END %]

[%- BLOCK parts_price_action %]
  <div>
    [%- PROCESS remove_control %]
    [% 'Part' | $T8 %] [% 'is' | $T8 %]
    [% P.part.picker('price_rule.items[].int', item.condition.id) %]
    <span>&nbsp;</span>
    [% 'set (set to)' | $T8 %]
    [% L.select_tag('price_rule.price_type', SELF.all_price_types, default=item.price_type) %]
    [% 'to (set to)' | $T8 %]
    [% L.input_tag('price_rule.action.price_as_number', item.action.price_as_number) %]
  <div>
[%- END %]

[%- BLOCK price_scale_action_input %]
<fieldset>
  <legend>[% 'Price Scale' | $T8 %]</legend>
  <div>
    [% IF item.is_array('conditional_action') %]
      [% FOREACH row = item.conditional_action %]
        [% INCLUDE conditional_action item=row %]
      [% END %]
    [% ELSE %]
      [% INCLUDE conditional_action item=item.conditional_action %]
    [% END %]
  </div>
  <span class='interact cursor-pointer'>Preis hinzufügen</span>
</fieldset>
[%- END %]

[%- BLOCK parts_price_list_action_input %]
<fieldset>
  <legend>[% 'Parts Price List' | $T8 %]</legend>
  <div>
    [% IF item.is_array('conditional_action') %]
      [% FOREACH row = item.conditional_action %]
        [% INCLUDE parts_price_action item=row %]
      [% END %]
    [% ELSE %]
      [% INCLUDE parts_price_action item=item.conditional_action %]
    [% END %]
  </div>
  <span class='interact cursor-pointer'>Preis hinzufügen</span>
</fieldset>
[%- END %]

[%- BLOCK add_element_control %]
  [% L.select_tag('', SELF.allowed_elements_for(item)) %] <span class='price_rule_macro_add_element interact cursor-pointer'>[% 'Add element' | $T8 %]</span>
[%- END %]

[%- BLOCK remove_control %]
  <span class='price_rule_macro_remove_line interact cursor-pointer'>✘</span>
[%- END %]

[%- BLOCK add_value %]
[%- END %]

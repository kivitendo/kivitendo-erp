[%- USE T8 %]
[%- USE HTML %]
[%- USE LxERP %]
[%- USE L %]
 [%- IF delivered %]
 [%- SET RO = ' readonly' %]
 [%- END %]

 <table>
  <tr>
   <td>[% 'Part Number' | $T8 %]</td>
   <td>[% part.partnumber | html %]</td>
  </tr>
  <tr>
   <td>[% 'Description' | $T8 %]</td>
   <td>[% part.description | html %]</td>
  </tr>
  <tr>
   <td>[% 'Qty according to delivery order' | $T8 %]</td>
   <td>[% LxERP.format_amount(do_qty) %] [% do_unit | html %]</td>
  </tr>
 </table>

  [%- UNLESS WHCONTENTS.size %]
  <p>[% 'There are no items in stock.' | $T8 %]</p>
  [%- ELSE %]

  [% L.hidden_tag("in_out", in_out) %]
  [% L.hidden_tag("parts_id", parts_id) %]
  [% L.hidden_tag("do_qty", do_qty) %]
  [% L.hidden_tag("do_unit", do_unit) %]
  [% L.hidden_tag("row", row, class="data-row") %]
  [% L.hidden_tag("item_id", item_id) %]

  <p>
   <table id="stock-in-out-table">
    <tr class="listheading">
     <th>&nbsp;</th>
     <th>[% 'Warehouse' | $T8 %]</th>
     <th>[% 'Bin' | $T8 %]</th>
     <th>[% 'Charge Number' | $T8 %]</th>
     [% IF INSTANCE_CONF.get_show_bestbefore %]
     <th>[% 'Best Before' | $T8 %]</th>
     [% END %]
     [%- UNLESS delivered %]
     <th align="right">[% 'Available qty' | $T8 %]</th>
     [%- END %]
     <th align="right">[% 'Qty' | $T8 %]</th>
     <th align="right">[% 'Unit' | $T8 %]</th>
    </tr>

    [%- FOREACH row = WHCONTENTS %]
    <tr [% IF row.stock_error %] class="error"[% ELSE %]class="listrow"[% END %]>
     <td>[% loop.count %]</td>
     <td>[% row.warehousedescription | html %]</td>
     <td>[% row.bindescription | html %]</td>
     <td>[% row.chargenumber | html %]</td>
     [% IF INSTANCE_CONF.get_show_bestbefore %]
     <td>[% row.bestbefore | html %]</td>
     [% END %]

     [%- IF delivered %]

     <td>[% LxERP.format_amount(row.stock_qty) | html %]</td>
     <td>
      [% row.stock_unit | html %]
      [% L.hidden_tag("unit", row.stock_unit, class="data-unit") %]
     </td>

     [%- ELSE %]

     <td>[% row.available_qty | html %]</td>
     <td>
      [% L.input_tag("qty", row.stock_qty                              ? LxERP.format_amount(row.stock_qty)
                          : (WHCONTENTS.size == 1) && (!row.stock_qty) ? LxERP.format_amount(do_qty)
                          : "", class="numeric data-qty", size="12") %]</td>
     <td>[% L.select_tag("unit_" _ loop.count, part.unit_obj.convertible_units, value_key="name", default=row.stock_unit, class="data-unit") %]</td>

     [%- END %]
     <td style="display:none">
      [% L.hidden_tag("warehouse_id", row.warehouse_id, class="data-warehouse-id") %]
      [% L.hidden_tag("bin_id", row.bin_id, class="data-bin-id") %]
      [% L.hidden_tag("chargenumber", row.chargenumber, class="data-chargenumber") %]
      [% L.hidden_tag("delivery_order_items_stock_id", row.delivery_order_items_stock_id, class="data-stock-id") %]
      [% L.hidden_tag("bestbefore", row.bestbefore, class="data-bestbefore") IF INSTANCE_CONF.get_show_bestbefore %]
     </td>
    </tr>

    [%- END %]
   </table>
  </p>

  <hr size="3" noshade>

  <p>[% L.button_tag('kivi.DeliveryOrder.save_updated_stock()', LxERP.t8('Save')) IF !delivered %]</p>

  [%- END %]
 </form>


